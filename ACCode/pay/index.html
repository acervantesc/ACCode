<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>JS Bin</title>
  <style>
        body { font-family: sans-serif; }
        .arc text { font-size: 12px; }
        .legend { font-size: 14px; }
    </style>
    <script src="https://d3js.org/d3.v7.min.js"></script>

</head>
<body>
 <h2>Ventas por Categoría</h2>
    <svg id="chart"></svg>
  
  <script>
  const width = 400;
const height = 400;
const radius = Math.min(width, height) / 2;

// Crea el elemento SVG y lo centra
const svg = d3.select("#chart")
    .attr("width", width)
    .attr("height", height)
    .append("g")
    .attr("transform", `translate(${width / 2}, ${height / 2})`);

// Define el generador de colores
const color = d3.scaleOrdinal(d3.schemeCategory10);

// Crea un generador de arcos (la forma de la dona)
const pie = d3.pie()
    .value(d => d.valor); // Accede a la columna 'valor'

// Define el arco interno y externo para el grosor de la dona
const arc = d3.arc()
    .innerRadius(radius * 0.5) // Grosor interno (agujero de la dona)
    .outerRadius(radius * 0.8); // Grosor externo

// Carga los datos del archivo CSV
d3.csv("data.csv").then(data => {
    // Convierte los valores de string a números
    console.log(data);

    data.forEach(d => {
        d.valor = +d.valor;
    });

    // Genera los "trozos de pastel"
    const arcs = pie(data);

    // Dibuja los arcos (las rebanadas de la dona)
    svg.selectAll("path")
        .data(arcs)
        .enter()
        .append("path")
        .attr("d", arc)
        .attr("fill", d => color(d.data.categoria))
        .attr("stroke", "white")
        .style("stroke-width", "2px");

    // Agrega las etiquetas de texto
    svg.selectAll("text")
        .data(arcs)
        .enter()
        .append("text")
        .text(d => d.data.categoria)
        .attr("transform", d => `translate(${arc.centroid(d)})`)
        .style("text-anchor", "middle");

    // Opcional: Agregar una leyenda
    const legend = svg.append("g")
        .attr("class", "legend")
        .attr("transform", `translate(${radius * 1.1}, -${height / 2})`);

    legend.selectAll("rect")
        .data(data)
        .enter()
        .append("rect")
        .attr("x", 0)
        .attr("y", (d, i) => i * 20)
        .attr("width", 10)
        .attr("height", 10)
        .attr("fill", d => color(d.categoria));

    legend.selectAll("text")
        .data(data)
        .enter()
        .append("text")
        .attr("x", 15)
        .attr("y", (d, i) => i * 20 + 9)
        .text(d => d.categoria);
});
    
    
  </script>
</body>
</html>